{"version":3,"sources":["webpack:///./src/pages/UpdateNews.vue?75aa","webpack:///src/pages/UpdateNews.vue","webpack:///./src/pages/UpdateNews.vue?f055","webpack:///./src/pages/UpdateNews.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_m","attrs","$v","form","title","$error","model","value","callback","$$v","$set","expression","CATEGORY","categories","on","$event","class","body","customToolbar","directives","name","rawName","_v","ref","handleFilePond","updateNews","staticRenderFns","components","data","title_picture","images","category","validations","required","mounted","GET_CATEGORY","viewNews","methods","fileImages","map","computed","component"],"mappings":"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","file":"js/chunk-2d0aa179.540f9769.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"page\"},[_c('div',{staticClass:\"page__content\"},[_vm._m(0),_c('div',{staticClass:\"create-news\"},[_c('div',{staticClass:\"create-news__form\"},[_c('v-input',{attrs:{\"label\":'Заголовок новости',\"error\":_vm.$v.form.title.$error,\"text-error\":'введите заголовок новости',\"require-input\":\"\"},model:{value:(_vm.$v.form.title.$model),callback:function ($$v) {_vm.$set(_vm.$v.form.title, \"$model\", $$v)},expression:\"$v.form.title.$model\"}}),_c('v-multiselect',{attrs:{\"label\":'Категория',\"options\":_vm.CATEGORY,\"value\":_vm.form.categories},on:{\"multi-change\":function($event){_vm.form.categories = $event}}}),_c('div',{staticClass:\"form-control\",class:{ 'form-control--error': _vm.$v.form.body.$error }},[_c('vue-editor',{attrs:{\"editorToolbar\":_vm.customToolbar},model:{value:(_vm.$v.form.body.$model),callback:function ($$v) {_vm.$set(_vm.$v.form.body, \"$model\", $$v)},expression:\"$v.form.body.$model\"}}),_c('label',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.$v.form.body.$error),expression:\"!$v.form.body.$error\"}]},[_vm._v(\"\\n            Описание новости\\n            \"),_c('span',{staticClass:\"form-control__require\"},[_vm._v(\"*\")])]),_c('label',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.$v.form.body.$error),expression:\"$v.form.body.$error\"}]},[_vm._v(\"введите описание новости\")])],1),_c('file-pond',{ref:\"pond\",attrs:{\"name\":\"test\",\"label-idle\":\"Добавить фото\",\"allow-multiple\":true,\"accepted-file-types\":\"image/jpeg, image/png\",\"imagePreviewHeight\":\"100\",\"allow-reorder\":true},on:{\"updatefiles\":_vm.handleFilePond,\"reorderfiles\":_vm.handleFilePond}}),_c('div',{staticClass:\"create-news__form-group-btn\"},[_c('button',{staticClass:\"button-primary\",on:{\"click\":_vm.updateNews}},[_vm._v(\"\\n            Отправить на проверку\\n          \")])])],1)])])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"page__header\"},[_c('h1',{staticClass:\"page__title\"},[_vm._v(\"\\n        Редактировать новость\\n      \")])])}]\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"page\">\r\n    <div class=\"page__content\">\r\n      <div class=\"page__header\">\r\n        <h1 class=\"page__title\">\r\n          Редактировать новость\r\n        </h1>\r\n      </div>\r\n      <div class=\"create-news\">\r\n        <div class=\"create-news__form\">\r\n          <v-input\r\n            :label=\"'Заголовок новости'\"\r\n            :error=\"$v.form.title.$error\"\r\n            v-model=\"$v.form.title.$model\"\r\n            :text-error=\"'введите заголовок новости'\"\r\n            require-input\r\n          />\r\n          <v-multiselect\r\n            :label=\"'Категория'\"\r\n            :options=\"CATEGORY\"\r\n            :value=\"form.categories\"\r\n            @multi-change=\"form.categories = $event\"\r\n          ></v-multiselect>\r\n          <div\r\n            class=\"form-control\"\r\n            :class=\"{ 'form-control--error': $v.form.body.$error }\"\r\n          >\r\n            <vue-editor\r\n              v-model=\"$v.form.body.$model\"\r\n              :editorToolbar=\"customToolbar\"\r\n            ></vue-editor>\r\n            <label v-show=\"!$v.form.body.$error\">\r\n              Описание новости\r\n              <span class=\"form-control__require\">*</span>\r\n            </label>\r\n            <label v-show=\"$v.form.body.$error\">введите описание новости</label>\r\n          </div>\r\n\r\n          <file-pond\r\n            name=\"test\"\r\n            ref=\"pond\"\r\n            label-idle=\"Добавить фото\"\r\n            :allow-multiple=\"true\"\r\n            accepted-file-types=\"image/jpeg, image/png\"\r\n            imagePreviewHeight=\"100\"\r\n            :allow-reorder=\"true\"\r\n            @updatefiles=\"handleFilePond\"\r\n            @reorderfiles=\"handleFilePond\"\r\n          />\r\n\r\n          <div class=\"create-news__form-group-btn\">\r\n            <button class=\"button-primary\" @click=\"updateNews\">\r\n              Отправить на проверку\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { required } from \"vuelidate/lib/validators\";\r\nimport { VueEditor } from \"vue2-editor\";\r\nimport qs from \"qs\";\r\nimport { mapActions, mapGetters } from \"vuex\";\r\n\r\nimport vueFilePond from \"vue-filepond\";\r\nimport \"filepond/dist/filepond.min.css\";\r\nimport \"filepond-plugin-image-preview/dist/filepond-plugin-image-preview.min.css\";\r\nimport FilePondPluginFileValidateType from \"filepond-plugin-file-validate-type\";\r\nimport FilePondPluginImagePreview from \"filepond-plugin-image-preview\";\r\nimport axios from \"axios\";\r\nimport VMultiselect from \"../components/vMultiselect\";\r\nimport VInput from \"../components/vInput\";\r\n\r\n// Create component\r\nconst FilePond = vueFilePond(\r\n  FilePondPluginFileValidateType,\r\n  FilePondPluginImagePreview\r\n);\r\n\r\nexport default {\r\n  name: \"UpdateNews\",\r\n  components: { VInput, VueEditor, FilePond, VMultiselect },\r\n  data() {\r\n    return {\r\n      form: {\r\n        title: \"\",\r\n        body: \"\",\r\n        categories: [],\r\n        title_picture: [],\r\n        images: []\r\n      },\r\n      title_picture: {},\r\n      images: [],\r\n      category: [],\r\n      customToolbar: [\r\n        [\"bold\", \"italic\", \"underline\"],\r\n        [{ list: \"ordered\" }, { list: \"bullet\" }]\r\n      ]\r\n    };\r\n  },\r\n  validations: {\r\n    form: {\r\n      title: {\r\n        required\r\n      },\r\n      body: {\r\n        required\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    this.GET_CATEGORY();\r\n    this.viewNews();\r\n  },\r\n  methods: {\r\n    ...mapActions(\"category\", [\"GET_CATEGORY\"]),\r\n    handleFilePond: function() {\r\n      let fileImages = this.$refs.pond.getFiles();\r\n      this.title_picture = fileImages.map(item => item.file)[0];\r\n      this.images = fileImages.map(item => item.file).slice(1);\r\n    },\r\n    async uploadImages() {\r\n      let formDataImages = new FormData();\r\n\r\n      this.images.forEach(item => {\r\n        formDataImages.append(\"file[]\", item);\r\n      });\r\n\r\n      await axios\r\n        .post(\r\n          `${process.env.VUE_APP_API_URL}/v1/post/upload-images`,\r\n          formDataImages,\r\n          {\r\n            headers: {\r\n              \"Content-Type\": \"multipart/form-data\"\r\n            }\r\n          }\r\n        )\r\n        .then(result => {\r\n          this.form.images = result.data.files;\r\n        })\r\n        .catch(error => {\r\n          console.log(error);\r\n        });\r\n    },\r\n    async uploadTitleImage() {\r\n      let formDataTitleImage = new FormData();\r\n      formDataTitleImage.append(\"file\", this.title_picture);\r\n\r\n      await axios\r\n        .post(\r\n          `${process.env.VUE_APP_API_URL}/v1/post/upload-title`,\r\n          formDataTitleImage,\r\n          {\r\n            headers: {\r\n              \"Content-Type\": \"multipart/form-data\"\r\n            }\r\n          }\r\n        )\r\n        .then(result => {\r\n          this.form.title_picture = result.data[0];\r\n        })\r\n        .catch(error => {\r\n          console.log(error);\r\n        });\r\n    },\r\n    async updateNews() {\r\n      this.$v.$touch();\r\n      if (!this.$v.$invalid) {\r\n        await this.uploadTitleImage();\r\n        await this.uploadImages();\r\n\r\n        let form = qs.stringify({\r\n          ...this.form,\r\n          category_ids: this.form.categories.map(item => item.id)\r\n        });\r\n\r\n        let url = new URL(`${process.env.VUE_APP_API_URL}/v1/post/update`);\r\n        url.searchParams.set(\"id\", this.$route.params.id);\r\n\r\n        await axios\r\n          .patch(url, form)\r\n          .then(() => {\r\n            this.$toasted.global.success(\r\n              \"Новость обновлена и отправлена на проверку\"\r\n            );\r\n            this.form = {\r\n              title: \"\",\r\n              body: \"\",\r\n              title_picture: [],\r\n              categories: [],\r\n              images: []\r\n            };\r\n            this.$refs.pond.removeFiles();\r\n            this.$v.$reset();\r\n            this.$router.push(\"/news\");\r\n          })\r\n          .catch(error => {\r\n            error.data.forEach(item => {\r\n              this.$toasted.global.error(item.message);\r\n            });\r\n          });\r\n      }\r\n    },\r\n    async viewNews() {\r\n      let load = this.$loading.show();\r\n\r\n      let url = new URL(`${process.env.VUE_APP_API_URL}/v1/post/view`);\r\n      url.searchParams.set(\"id\", this.$route.params.id);\r\n\r\n      await axios\r\n        .get(url)\r\n        .then(response => {\r\n          this.form.title = response.data.title;\r\n          this.form.body = response.data.body;\r\n          this.form.categories = response.data.categories;\r\n          this.load = true;\r\n          load.hide();\r\n        })\r\n        .catch(error => {\r\n          if (error.response.status === 404) {\r\n            this.$toasted.global.error(\"Новость не найдена\");\r\n            this.$router.push(\"/news\");\r\n          } else {\r\n            this.$toasted.global.error(error.response.data.message);\r\n          }\r\n          if (!error.response) {\r\n            this.$toasted.global.error(\"Нет соединения с сервером\");\r\n            load.hide();\r\n          }\r\n          load.hide();\r\n        });\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters(\"category\", [\"CATEGORY\"])\r\n  }\r\n};\r\n</script>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UpdateNews.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UpdateNews.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./UpdateNews.vue?vue&type=template&id=19c84b8c&\"\nimport script from \"./UpdateNews.vue?vue&type=script&lang=js&\"\nexport * from \"./UpdateNews.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}